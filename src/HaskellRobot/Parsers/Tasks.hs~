module HaskellRobot.Parsers.Tasks
       ( tasksParser
       ) where

import           Control.Applicative        ((<|>))

import           Text.Megaparsec            (anyChar, between, char, digitChar,
                                             letterChar, someTill, optional, some,
                                             spaceChar, string, try)
import           Text.Megaparsec.String     (Parser)

import           HaskellRobot.Data.Task     (TaskBlock, TaskSet)
import           HaskellRobot.Parsers.Utils (spaces)

taskExampleParser :: Parser TaskSet
taskExampleParser = some $ spaces *> string "[[" *> someTill anyChar (try $ string "]]") <* spaces

tasksParser :: Parser TaskBlock
tasksParser = some $ do
    () <$ optional (some digitChar)
    () <$ optional (between (char '(') (char ')') blockNameParser)
    between (string "{{") (string "}}") taskExampleParser <* spaces
  where
    blockNameParser = some $ letterChar <|> spaceChar <|> digitChar
